@page "/account/manage/"
@attribute [Authorize]
@using Features.Account.Manage
@inject HttpClient Http

<TwHeader2>Profile</TwHeader2>

@if (!string.IsNullOrEmpty(Success))
{
    <TwAlertSuccess>
        @Success
    </TwAlertSuccess>
}

<TwSubCard>
    <EditForm Model="Model" OnValidSubmit="HandleProfile">
        <FluentValidationValidator />
        <TwEditContextClasses />

        <TwInputText @bind-Value="@Model.Email"
                     ValidationFor="@(() => Model.Email)"
                     disabled class="bg-gray-100"
                     Label="User Name" />

        <TwInputText @bind-Value="@Model.PhoneNumber"
                     ValidationFor="@(() => Model.PhoneNumber)"
                     Label="Phone Number" />

        <TwButton>Save</TwButton>
    </EditForm>
</TwSubCard>

    @code
{
        private UserProfile.Command Model = new();
        private string Success { get; set; }

        protected override async Task OnInitializedAsync()
        {
            Model = await Http.GetFromJsonAsync<UserProfile.Command>("api/account/manage/userprofile");
        }

        private async Task HandleProfile()
        {
            var response = await Http.PostAsJsonAsync("api/account/manage/userprofile", Model);
            var result = await response.Content.ReadFromJsonAsync<UserProfile.Result>();

            if (result.IsSuccessful)
            {
                Success = result.Message;
            }
        }
    }
