@page "/account/forgotpassword"
@inject NavigationManager NavigationManager
@inject HttpClient Http

<TwHeader1>Forgot Password</TwHeader1>

<TwCard Class="lg:w-1/2">
    <EditForm Model="Model" OnValidSubmit="SubmitForgotPassword">
        <FluentValidationValidator />
        <ServerValidator @ref="serverValidator" />
        <TwEditContextClasses />

        <TwInputText @bind-Value="@Model.Email"
                     ValidationFor="@(() => Model.Email)"
                     type="email"
                     placeholder="you@example.com"
                     Label="Email" />

        <TwButton>Submit</TwButton>
    </EditForm>
</TwCard>

@code
{
    private Features.Account.ForgotPassword.Command Model = new();
    private ServerValidator serverValidator;

    private async Task SubmitForgotPassword()
    {
        var response = await Http.PostAsJsonAsync("api/account/forgotpassword", Model);
        var result = await response.Content.ReadFromJsonAsync<Features.Account.ForgotPassword.Result>();

        if (result.IsSuccessful)
        {
            NavigationManager.NavigateTo("/Account/ForgotPasswordConfirmation");
        }
        else
        {
            serverValidator.DisplayErrors(result.Errors);
        }

    }

}
